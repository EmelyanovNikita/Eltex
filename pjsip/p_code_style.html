<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>esbc: Code Style проекта E-SBC</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">esbc
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('df/de0/p_code_style.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Code Style проекта E-SBC</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><ul><li class="level2"><a href="#autotoc_md86">1. Общие положения по оформлению</a></li>
<li class="level2"><a href="#autotoc_md88">2. Стиль написания - &quot;snake_case&quot;</a></li>
<li class="level2"><a href="#autotoc_md90">3. Пробелы между операторами, именами и литералами</a></li>
<li class="level2"><a href="#autotoc_md92">4. Именования</a><ul><li class="level3"><a href="#autotoc_md94">4.1. Переменные</a></li>
<li class="level3"><a href="#autotoc_md96">4.2. Функции</a></li>
<li class="level3"><a href="#autotoc_md100">4.3. Файлы</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md105">5. Директивы препроцессора</a><ul><li class="level3"><a href="#autotoc_md108">5.1. Отступы</a></li>
<li class="level3"><a href="#autotoc_md110">5.2. Защитные #define&#39;ы</a></li>
<li class="level3"><a href="#autotoc_md114">5.3. Имена макросов</a></li>
<li class="level3"><a href="#autotoc_md116">5.4. Значения макросов</a></li>
<li class="level3"><a href="#autotoc_md120">5.5. Директивы #include</a></li>
<li class="level3"><a href="#autotoc_md124">5.6. Условные директивы</a></li>
</ul>
</li>
<li class="level2"><a href="#point6">6. Оформление файлов</a></li>
<li class="level2"><a href="#autotoc_md139">7. Функции</a><ul><li class="level3"><a href="#autotoc_md143">7.1. Внешние функции</a></li>
<li class="level3"><a href="#autotoc_md148">7.2. Внутренние функции</a></li>
<li class="level3"><a href="#autotoc_md152">7.3. Объём функции</a></li>
<li class="level3"><a href="#autotoc_md157">7.4. Количество параметров</a></li>
<li class="level3"><a href="#autotoc_md163">7.5. Форматирование параметров</a></li>
<li class="level3"><a href="#autotoc_md169">7.6. Функции без параметров</a></li>
<li class="level3"><a href="#autotoc_md173">7.7. Возвращение значений</a></li>
<li class="level3"><a href="#autotoc_md175">7.8. Точка выхода из функции</a></li>
<li class="level3"><a href="#autotoc_md177">7.9. Оператор return, статус выполнения</a></li>
<li class="level3"><a href="#autotoc_md179">7.10. Фабричные функции</a></li>
<li class="level3"><a href="#autotoc_md181">7.11. Спецификатор const</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md183">8. Переменные</a><ul><li class="level3"><a href="#autotoc_md185">8.1. Объявление</a></li>
<li class="level3"><a href="#autotoc_md187">8.2. Инициализация</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md189">9. Перечисления</a></li>
<li class="level2"><a href="#autotoc_md191">10. Структуры</a></li>
<li class="level2"><a href="#autotoc_md193">11. Объединения</a></li>
<li class="level2"><a href="#autotoc_md195">12. Оператор sizeof</a></li>
<li class="level2"><a href="#autotoc_md197">13. Битовые поля</a></li>
<li class="level2"><a href="#autotoc_md199">14. Константы</a></li>
<li class="level2"><a href="#autotoc_md204">15. Magic Numbers</a></li>
<li class="level2"><a href="#autotoc_md207">16. Форматирование</a></li>
<li class="level2"><a href="#autotoc_md209">16.1 Приоритет операций</a><ul><li class="level3"><a href="#autotoc_md214">16.2 Перенос сложных логических выражений</a></li>
<li class="level3"><a href="#autotoc_md216">16.3 Комментарии</a></li>
<li class="level3"><a href="#autotoc_md221">16.4 #warning и TODO</a></li>
<li class="level3"><a href="#autotoc_md223">16.5 Оператор if</a></li>
<li class="level3"><a href="#autotoc_md225">16.6 Цикл for</a></li>
<li class="level3"><a href="#autotoc_md227">16.7 Цикл while</a></li>
<li class="level3"><a href="#autotoc_md229">16.8 Цикл do-while</a></li>
<li class="level3"><a href="#autotoc_md231">16.9 Оператор switch</a></li>
<li class="level3"><a href="#autotoc_md233">16.10 Оператор goto</a></li>
</ul>
</li>
</ul>
</ul>
</div>
<div class="textblock"><h2><a class="anchor" id="autotoc_md86"></a>
1. Общие положения по оформлению</h2>
<ol type="1">
<li>Максимальная длина строки - <b>120</b></li>
<li>Не использовать табуляции - <b>только пробелы</b></li>
<li>Отступ - <b>4 пробела</b></li>
<li>Открывющийся блок <b>"{"</b> с новой строки</li>
</ol>
<hr  />
<h2><a class="anchor" id="autotoc_md88"></a>
2. Стиль написания - "snake_case"</h2>
<p>Для состовления имён функций и переменных используется стиль "snake_case"</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> my_good_variable_name;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> my_good_function_name(<span class="keywordtype">int</span> my_good_param_1, <span class="keywordtype">int</span> my_good_param_2);</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> myBadVariableName;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> MyBadFunctionName1(<span class="keywordtype">int</span> myBadParam_1, <span class="keywordtype">int</span> MyBadParam2);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> my_badFunctionName2(<span class="keywordtype">void</span>);</div>
</div><!-- fragment --> </details>
<hr  />
<h2><a class="anchor" id="autotoc_md90"></a>
3. Пробелы между операторами, именами и литералами</h2>
<p>Все бинарные операторы, имена и литералы отделяются пробелами</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line">sum = a + b;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; 10; ++i) {}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span> (condition) {}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> ((condition == 0) || !spec_condition) {}</div>
<div class="line"> </div>
<div class="line">a = condition ? result_1 : result_2;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> array[] = { 1, 2, 3 }</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line">sum=a+b;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span>(i=0;i&lt;10;++i) {}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span>(condition) {}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> ((condition==0) || !spec_condition){}</div>
<div class="line"> </div>
<div class="line">a = condition? result_1:result_2;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> array[] = {1, 2, 3}</div>
</div><!-- fragment --> </details>
<p><b>Не отделяется</b> пробелом имя функции и её параметры</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> function(<span class="keywordtype">int</span> param);</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> function (<span class="keywordtype">int</span> param);</div>
</div><!-- fragment --> </details>
<p>Унарные операторы <b>не отделяются</b> пробелом от операнда</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> var_2 = !var_1;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> value = *int_ptr;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> address = &amp;val;</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> var_2 = ! var_1;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> value = * int_ptr;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> address = &amp; val;</div>
</div><!-- fragment --> </details>
<p>При объявлении указателей символ "*" отделяется пробелом от типа указателя, но прилегает к имени указателя или функции</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> *ptr;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> *str;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> *function(<span class="keywordtype">int</span> *param_ptr);</div>
<div class="line"> </div>
<div class="line">void (*function_ptr)(<span class="keywordtype">int</span> *param_ptr)</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> * ptr;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span>* str;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> * function(<span class="keywordtype">int</span>*param_ptr);</div>
<div class="line"> </div>
<div class="line">void (* function_ptr)(<span class="keywordtype">int</span> * param_ptr)</div>
</div><!-- fragment --> </details>
<hr  />
<h2><a class="anchor" id="autotoc_md92"></a>
4. Именования</h2>
<hr  />
<h3><a class="anchor" id="autotoc_md94"></a>
4.1. Переменные</h3>
<p>Название переменной должно быть лаконичным и понятным, можно использовать устоявшиеся сокращения, аббревиатуры или специальные названия, если они понятны из контекста</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> i, j, k; <span class="comment">// in context of for() cycle</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> r, g, b; <span class="comment">// in context of interaction with RGB color model</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> cnt;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> *str;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> symbol;</div>
<div class="line"> </div>
<div class="line">uint8_t cfg_is_ready;</div>
<div class="line"> </div>
<div class="line">messate_t msg;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> ip_str[4];</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> a, b1; <span class="comment">// out of context</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> super_variable_name_for_very_special_case_in_production;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> crt_new_mltprt_boddy;</div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md96"></a>
4.2. Функции</h3>
<p>Название функции должно отражать сущность и действие над этой сущностью или её состояние. По названию функции должно быть однозначно понятно, что она делает. Также название функции, если она имеет внешний прототип, должно содержать префикс модуля и иметь следующий вид:</p>
<p><b>prefix_object_action()</b></p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="../../d3/d33/group__ipc__subsystem.html#gab61ec2baaa8de75c6384d33ddcb11a2c">ipc_connection_create</a>(ipc_conn_t **<a class="code hl_variable" href="../../d3/d33/group__ipc__subsystem.html#gafa77ba77b323a4ca452d177ad1225076">conn</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> ipc_connection_establish(ipc_conn_t *<a class="code hl_variable" href="../../d3/d33/group__ipc__subsystem.html#gafa77ba77b323a4ca452d177ad1225076">conn</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> ipc_connection_close(ipc_conn_t *<a class="code hl_variable" href="../../d3/d33/group__ipc__subsystem.html#gafa77ba77b323a4ca452d177ad1225076">conn</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> ipc_connection_is_established(ipc_conn_t *<a class="code hl_variable" href="../../d3/d33/group__ipc__subsystem.html#gafa77ba77b323a4ca452d177ad1225076">conn</a>);</div>
<div class="ttc" id="agroup__ipc__subsystem_html_gab61ec2baaa8de75c6384d33ddcb11a2c"><div class="ttname"><a href="../../d3/d33/group__ipc__subsystem.html#gab61ec2baaa8de75c6384d33ddcb11a2c">ipc_connection_create</a></div><div class="ttdeci">pj_status_t ipc_connection_create(const char *server_url, ipc_con_disconnected_cb cb)</div><div class="ttdoc">Creating a ipc connection to the server.</div><div class="ttdef"><b>Definition</b> esbc_ipc.c:922</div></div>
<div class="ttc" id="agroup__ipc__subsystem_html_gafa77ba77b323a4ca452d177ad1225076"><div class="ttname"><a href="../../d3/d33/group__ipc__subsystem.html#gafa77ba77b323a4ca452d177ad1225076">conn</a></div><div class="ttdeci">natsConnection * conn</div><div class="ttdoc">Pointer to server connection.</div><div class="ttdef"><b>Definition</b> esbc_ipc.c:313</div></div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ipc_create_connection(ipc_conn_t **<a class="code hl_variable" href="../../d3/d33/group__ipc__subsystem.html#gafa77ba77b323a4ca452d177ad1225076">conn</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> ipc_close_connection(ipc_conn_t *<a class="code hl_variable" href="../../d3/d33/group__ipc__subsystem.html#gafa77ba77b323a4ca452d177ad1225076">conn</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> establish_connection_ipc(ipc_conn_t *<a class="code hl_variable" href="../../d3/d33/group__ipc__subsystem.html#gafa77ba77b323a4ca452d177ad1225076">conn</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> established_connection(ipc_conn_t *<a class="code hl_variable" href="../../d3/d33/group__ipc__subsystem.html#gafa77ba77b323a4ca452d177ad1225076">conn</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> ipc_connection_do(ipc_conn_t *<a class="code hl_variable" href="../../d3/d33/group__ipc__subsystem.html#gafa77ba77b323a4ca452d177ad1225076">conn</a>); <span class="comment">// do what?</span></div>
</div><!-- fragment --> </details>
<p>Названия функций используемых в качестве коллбеков или виртуальных функций должно быть оформленно по тому же правилу, но с добавлением специальных постфиксов:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Коллбеки   </td><td class="markdownTableBodyNone"><b>prefix_object_action_cb()</b>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Вирутальные функции   </td><td class="markdownTableBodyNone"><b>prefix_object_action_func()</b>   </td></tr>
</table>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line">strcut callbacks_t</div>
<div class="line">{</div>
<div class="line">    void (*on_rx_data)(<span class="keywordtype">void</span> *<a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>);</div>
<div class="line">} cb;</div>
<div class="line"> </div>
<div class="line">strcut iface_t</div>
<div class="line">{</div>
<div class="line">    void (*data_tx)(<span class="keywordtype">void</span> *<a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>);</div>
<div class="line">} iface;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> ipc_data_rx_cb(<span class="keywordtype">void</span> *<a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>);</div>
<div class="line"><span class="keywordtype">void</span> ipc_data_tx_func(<span class="keywordtype">void</span> *<a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>);</div>
<div class="line"> </div>
<div class="line">cb.on_rx_data   = ipc_data_rx_cb;</div>
<div class="line">iface.data_send = ipc_data_tx_func;</div>
<div class="ttc" id="agroup__sipbl__monitor_html_gad04c150c29025c694cfdb62b3caf2a27"><div class="ttname"><a href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a></div><div class="ttdeci">static sysmon_init_data_t data</div><div class="ttdoc">Sysmon metrics data.</div><div class="ttdef"><b>Definition</b> sipbl_monitor.c:55</div></div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line">strcut callbacks_t</div>
<div class="line">{</div>
<div class="line">    void (*on_rx_data)(<span class="keywordtype">void</span> *<a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>);</div>
<div class="line">} cb;</div>
<div class="line"> </div>
<div class="line">strcut iface_t</div>
<div class="line">{</div>
<div class="line">    void (*data_tx)(<span class="keywordtype">void</span> *<a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>);</div>
<div class="line">} iface;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> ipc_data_rx(<span class="keywordtype">void</span> *<a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>);</div>
<div class="line"><span class="keywordtype">void</span> ipc_data_tx(<span class="keywordtype">void</span> *<a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>);</div>
<div class="line"> </div>
<div class="line">cb.on_rx_data   = ipc_data_rx;</div>
<div class="line">iface.data_send = ipc_data_tx;</div>
</div><!-- fragment --> </details>
<p>Переопределяемые типы для указателей на функции должны также соответствовать правилу описанному выше:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Указатели на коллбеки   </td><td class="markdownTableBodyNone"><b>name_cb</b>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Указатели на виртуальные функции   </td><td class="markdownTableBodyNone"><b>name_func</b>   </td></tr>
</table>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> void (*data_rx_cb)(<span class="keywordtype">void</span> *<a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>);</div>
<div class="line"><span class="keyword">typedef</span> void (*data_tx_func)(<span class="keywordtype">void</span> *<a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>);</div>
<div class="line"> </div>
<div class="line">strcut callbacks_t</div>
<div class="line">{</div>
<div class="line">    data_rx_cb on_rx_data;</div>
<div class="line">} cb;</div>
<div class="line"> </div>
<div class="line">strcut iface_t</div>
<div class="line">{</div>
<div class="line">    data_tx_func data_send;</div>
<div class="line">} iface;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> ipc_data_rx_cb(msg_t *message);</div>
<div class="line"><span class="keywordtype">void</span> ipc_data_tx_func(msg_t *message);</div>
<div class="line"> </div>
<div class="line">cb.on_rx_data   = (data_rx_cb)  ipc_data_rx_cb;</div>
<div class="line">iface.data_send = (data_tx_func)ipc_data_tx_func;</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> void (*data_rx)(<span class="keywordtype">void</span> *<a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>);</div>
<div class="line"><span class="keyword">typedef</span> void (*data_tx)(<span class="keywordtype">void</span> *<a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>);</div>
<div class="line"> </div>
<div class="line">strcut callbacks_t</div>
<div class="line">{</div>
<div class="line">    data_rx on_rx_data;</div>
<div class="line">} cb;</div>
<div class="line"> </div>
<div class="line">strcut iface_t</div>
<div class="line">{</div>
<div class="line">    data_tx data_send;</div>
<div class="line">} iface;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> ipc_data_rx_cb(msg_t *message);</div>
<div class="line"><span class="keywordtype">void</span> ipc_data_tx_func(msg_t *message);</div>
<div class="line"> </div>
<div class="line">cb.on_rx_data   = (data_rx)ipc_data_rx_cb;</div>
<div class="line">iface.data_send = (data_tx)ipc_data_tx_func;</div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md100"></a>
4.3. Файлы</h3>
<p>Для имён файлов также используется "snake_case".</p>
<p>Файлы заголовков - *.h Файлы исходников - *.c</p>
<p>Названия должны быть лаконичными и понятными, отражать сущность модуля.</p>
<p>Файл содержащий функицю main() должен называться "main.c"</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line">phone_fsm.h</div>
<div class="line">phone_fsm.c</div>
<div class="line">conference.h</div>
<div class="line">conference_manager.h</div>
<div class="line">conference_manager.c</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line">appLogic.c</div>
<div class="line">my_spectial_utils.c</div>
<div class="line">time_proc_for_registration_event_in_special_case.h</div>
<div class="line">good.c</div>
<div class="line"><a class="code hl_variable" href="../../d8/d67/group__esbc__imdb__func.html#ga036ce4298c53f676b938c1edef5f9297">proc</a>.c</div>
<div class="ttc" id="agroup__esbc__imdb__func_html_ga036ce4298c53f676b938c1edef5f9297"><div class="ttname"><a href="../../d8/d67/group__esbc__imdb__func.html#ga036ce4298c53f676b938c1edef5f9297">proc</a></div><div class="ttdeci">static imdb_proc_t * proc</div><div class="ttdoc">Processing funcions.</div><div class="ttdef"><b>Definition</b> esbc_imdb_func.c:30</div></div>
</div><!-- fragment --> </details>
<hr  />
<h2><a class="anchor" id="autotoc_md105"></a>
5. Директивы препроцессора</h2>
<hr  />
<h3><a class="anchor" id="autotoc_md108"></a>
5.1. Отступы</h3>
<p>Все директивы препроцессора начинаются без отступов слева</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef SOMETHING</span></div>
<div class="line"><span class="preprocessor">#define SOMETHING</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* SOMETHING */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> foo(<span class="keywordtype">int</span> param)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (param &amp; 0x1)</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#ifdef CONDITION</span></div>
<div class="line">        <span class="keywordflow">return</span> param + 10;</div>
<div class="line"><span class="preprocessor">#else </span><span class="comment">/* CONDITION */</span><span class="preprocessor"></span></div>
<div class="line">        <span class="keywordflow">return</span> param * 10;</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CONDITION */</span><span class="preprocessor"></span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef SOMETHING</span></div>
<div class="line"><span class="preprocessor">    #define SOMETHING</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* SOMETHING */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> foo(<span class="keywordtype">int</span> param)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (param &amp; 0x1)</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">    #ifdef CONDITION</span></div>
<div class="line">        <span class="keywordflow">return</span> param + 10;</div>
<div class="line"><span class="preprocessor">    #else </span><span class="comment">/* CONDITION */</span><span class="preprocessor"></span></div>
<div class="line">        <span class="keywordflow">return</span> param * 10;</div>
<div class="line"><span class="preprocessor">    #endif </span><span class="comment">/* CONDITION */</span><span class="preprocessor"></span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md110"></a>
5.2. Защитные #define'ы</h3>
<p>Все заголовочные файлы должны быть защищены защитными #define'ами.</p>
<p>Защитные макросы должны иметь следующий вид: </p><pre class="fragment">    _PFX_FILE_NAME_
</pre><details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="comment">/* system_info.h */</span></div>
<div class="line"><span class="preprocessor">#ifndef _ESBC_SYSTEM_INFO_H_</span></div>
<div class="line"><span class="preprocessor">#define _ESBC_SYSTEM_INFO_H_</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* your code */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* _ESBC_SYSTEM_INFO_H_ */</span><span class="preprocessor"></span></div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="comment">/* system_info.h */</span></div>
<div class="line"><span class="preprocessor">#ifndef SYSTEM-INFO</span></div>
<div class="line"><span class="preprocessor">#define SYSTEM-INFO</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* your code */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* SYSTEM-INFO */</span><span class="preprocessor"></span></div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md114"></a>
5.3. Имена макросов</h3>
<p>Все имена макросов пишутся в "SNAKE_CASE" большими буквами</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="preprocessor">#define IS_EVEN(val) (!(val &amp; 1))</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define IS_GOOD_VAL(val) (IS_EVEN(val))</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define CLOCK_RATE 8000</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SYSTEM_NAME &quot;E-SBC&quot;</span></div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="preprocessor">#define IsEven(val) (!(val &amp; 1))</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define is_good_val(val) (IsEven(val))</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define CLOCKRATE 8000</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SYSTEM-NAME &quot;E-SBC&quot;</span></div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md116"></a>
5.4. Значения макросов</h3>
<p>Значения макросов состоящие из одного литерала или функции можно писать без "()" Значения макросов состоящие из выражения или других макросов пишутся в "()" Аргументы макросов в значении макроса пишутся только в "()"</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="preprocessor">#define IS_EVEN(val) (!((val) &amp; 1))</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define IS_GOOD_VAL(val) (IS_EVEN((val)))</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NOT(val) (!(val))</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define CALLWAIT_NOTIFY_TIMEOUT (3 * 10)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define CLOCKRATE 8000</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SYSTEM-NAME &quot;E-SBC&quot;</span></div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="preprocessor">#define IS_EVEN(val) !(val &amp; 1)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define IS_GOOD_VAL(val) IS_EVEN(val)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NOT(val) !val</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define CALLWAIT_NOTIFY_TIMEOUT 3 * 10</span></div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md120"></a>
5.5. Директивы #include</h3>
<ol type="1">
<li>Любой файл использующий функции или типы определённые в каком либо заголовочном файле обязан включать в себя #include с этим файлом</li>
<li>Первым делом подключаются системные заголовочные файлы - #include &lt;&gt;</li>
<li>После системных подключаются локальные заголовочные файлы - #include ""</li>
<li><b>Запрещено</b> включать файлы исходных кодов</li>
</ol>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;pjsip.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;conference_manager.h&quot;</span></div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pjsip.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;conference_manager.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;generic_func.c&quot;</span></div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md124"></a>
5.6. Условные директивы</h3>
<ol type="1">
<li>В комментариях к #else и #endif должно быть значение условия</li>
<li>Если тело условия небольшое (от #if до #endif не более 40 строк), и в условии нет #else, то комментарий можно не писать</li>
</ol>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef USE_SMX</span></div>
<div class="line"><span class="comment">/* less then 40 lines */</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if !defined(M_PI)</span></div>
<div class="line"><span class="preprocessor">#else  </span><span class="comment">/* !defined(M_PI) */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* !defined(M_PI) */</span><span class="preprocessor"></span></div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef USE_SMX</span></div>
<div class="line"><span class="comment">/* more then 40 lines */</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if !define(M_PI)</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --> </details>
<hr  />
<h2><a class="anchor" id="point6"></a>
6. Оформление файлов</h2>
<p>Заголовочные файлы и файлы исходных кодов оформляются по следующему порядку:</p>
<ol type="1">
<li>Защитные #define'ы (*.h)</li>
<li>Директивы #include</li>
<li>Макросы</li>
<li>Объявления типов (typedef'ы, структуры, enum'ы и т.д.)</li>
<li>Прототипы функций</li>
<li>Глобальные переменные (*.c)</li>
<li>Определения функций (*.c)</li>
</ol>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="comment">/* module.c */</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdint.t&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;blf.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;session.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MSG_TABLE_SIZE 10</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> uint16_t u16;</div>
<div class="line"> </div>
<div class="line">typdef <span class="keyword">struct </span>msg_t</div>
<div class="line">{</div>
<div class="line">    u16 header;</div>
<div class="line">    u16 <a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>;</div>
<div class="line">} msg_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> foo();</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> bar();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> msg_t msg_table[MSG_TABLE_SIZE];</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> foo()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* foo implementation */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> bar()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* bar implementation */</span></div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="comment">/* module.c */</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdint.t&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MSG_TABLE_SIZE 10</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;blf.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> uint16_t u16;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> foo();</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> bar();</div>
<div class="line"> </div>
<div class="line">typdef <span class="keyword">struct </span>msg_t</div>
<div class="line">{</div>
<div class="line">    u16 header;</div>
<div class="line">    u16 <a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>;</div>
<div class="line">} msg_t;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;session.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> foo()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* foo implementation */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> msg_t msg_table[MSG_TABLE_SIZE];</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> bar()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* bar implementation */</span></div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<hr  />
<h2><a class="anchor" id="autotoc_md139"></a>
7. Функции</h2>
<hr  />
<h3><a class="anchor" id="autotoc_md143"></a>
7.1. Внешние функции</h3>
<ol type="1">
<li>Функция модуля является внешней, если требуется её вызов из другого модуля</li>
<li>Прототипы внешних функций модуля выносятся в заголовочный файл *.h модуля</li>
<li>Названия внешних функций начинаются с префикса модуля</li>
</ol>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="comment">/* module_header.h */</span></div>
<div class="line"><span class="keywordtype">int</span> module_pfx_foo();</div>
<div class="line"><span class="keywordtype">int</span> module_pfx_bar();</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="comment">/* module_header.h */</span></div>
<div class="line"><span class="keywordtype">int</span> foo();</div>
<div class="line"><span class="keywordtype">int</span> bar();</div>
<div class="line"><span class="keywordtype">int</span> inner_function(); <span class="comment">/* called in module only, but declared here for future external use */</span></div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md148"></a>
7.2. Внутренние функции</h3>
<ol type="1">
<li>Функция модуля является внутренней если её вызов осуществляется только внутри этого модуля</li>
<li>Прототипы внутренних функций описываются верхней части файла *.c в соответствие c <a class="el" href="../../df/de0/p_code_style.html#point6">п. 6</a></li>
<li>Названия внутренних функций не должны содержать префикс внешних функций модуля</li>
<li>Прототипы и определения внутренних функций дополняются спецификатором <b>static</b></li>
</ol>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="comment">/* module.с */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> inner_pfx_foo();</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> bar();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> inner_pfx_foo()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> bar();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> bar()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* bar() implementation */</span></div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="comment">/* module.с */</span></div>
<div class="line"><span class="keywordtype">int</span> module_pfx_foo();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> bar()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* bar() implementation */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> module_pfx_foo()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> bar();</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md152"></a>
7.3. Объём функции</h3>
<p>Определение функции не должно занимать больше "двух экранов" (60-80 строк)</p>
<hr  />
<h3><a class="anchor" id="autotoc_md157"></a>
7.4. Количество параметров</h3>
<p>Функция не должна содержать больше 5 параметров</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>complex_param_t</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> p1;</div>
<div class="line">    <span class="keywordtype">int</span> p2;</div>
<div class="line">    <span class="keywordtype">int</span> p3;</div>
<div class="line">    <span class="keywordtype">int</span> p4;</div>
<div class="line">    <span class="keywordtype">int</span> p5;</div>
<div class="line">    <span class="keywordtype">int</span> p6;</div>
<div class="line">    <span class="keywordtype">int</span> p7;</div>
<div class="line">} complex_param_t;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> foo(<span class="keywordtype">int</span> param1, <span class="keywordtype">int</span> param2, complex_param_t param3);</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> foo(<span class="keywordtype">int</span> param1, <span class="keywordtype">int</span> param2, <span class="keywordtype">int</span> param3, <span class="keywordtype">int</span> param4, <span class="keywordtype">int</span> param5, <span class="keywordtype">int</span> param6, <span class="keywordtype">int</span> param7, <span class="keywordtype">int</span> param8, <span class="keywordtype">int</span> param9);</div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md163"></a>
7.5. Форматирование параметров</h3>
<p>При нехватке места параметры функции форматируются двумя способами:</p>
<ol type="1">
<li>Друг под другом каждый на уровне первого параметра</li>
<li>Оставление одного параметра на строке с именем (при возможности), перенос второго на следующую строку с двумя отступами от начала и расположение остальных параметров под вторым, каждый на своей строке</li>
</ol>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> *long_function_name_that_is_really_needed_and_approved(<span class="keywordtype">int</span> param_name_long_enough1,</div>
<div class="line">                                                            <span class="keywordtype">int</span> long_name_parameter_name_that_is_really_needed2,</div>
<div class="line">                                                            <span class="keywordtype">int</span> not_so_long_param_name3,</div>
<div class="line">                                                            <span class="keywordtype">int</span> param4)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* implementation */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> long_complex_type_name_t *another_long_function_name_that_is_really_needed_and_approved(<span class="keywordtype">int</span> param_name1,</div>
<div class="line">        <span class="keywordtype">int</span> long_name_parameter_name_that_is_really_needed2,</div>
<div class="line">        <span class="keywordtype">int</span> not_so_long_param_name3,</div>
<div class="line">        <span class="keywordtype">int</span> param4)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* implementation */</span></div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> *long_function_name_that_is_really_needed_and_approved(<span class="keywordtype">int</span> param_name_long_enough1, <span class="keywordtype">int</span> long_name_parameter_name_that_is_really_needed2,</div>
<div class="line">                                                            <span class="keywordtype">int</span> not_so_long_param_name3,  <span class="keywordtype">int</span> param4)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* implementation */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> long_complex_type_name_t *another_long_function_name_that_is_really_needed_and_approved(<span class="keyword">const</span> <span class="keywordtype">int</span> param_name_long_enough1,</div>
<div class="line">                        <span class="keywordtype">int</span> long_name_parameter_name_that_is_really_needed2, <span class="keywordtype">int</span> not_so_long_param_name3,  <span class="keywordtype">int</span> param4)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* implementation */</span></div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md169"></a>
7.6. Функции без параметров</h3>
<p>Функции не принимающие параметры должны быть объявлены с типом <b>void</b></p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> print_system_info(<span class="keywordtype">void</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> print_system_info(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* code */</span></div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> print_system_info();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> print_system_info()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* code */</span></div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md173"></a>
7.7. Возвращение значений</h3>
<p>Через <b>return</b> функция может возвращать:</p>
<ul>
<li>результат выполнения - истинность проверяемого значения, кол-во переданных байт, размер структур данных и т.д.</li>
<li>статус выполнения - код успеха или код ошибки (см. Оператор return, статус выполнения)</li>
</ul>
<p>Через <b>return</b> нельзя возвращать указатель на выделенную внутри функции память (см. Фабричные функции)</p>
<p>Функция возвращающая статус выполнения может возвращать результат выполнения через параметры</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> msg_size(<span class="keyword">const</span> msg_t *msg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> msg-&gt;size;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">uint8_t msg_is_valid(<span class="keyword">const</span> msg_t *msg)</div>
<div class="line">{</div>
<div class="line">    uint8_t mistakes_in_msg = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* check */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> !mistakes_in_msg;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">status_t msg_parse(uint8_t *<a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>, uint8_t len, msg_t *msg)</div>
<div class="line">{</div>
<div class="line">    status_t res = -1;</div>
<div class="line">    <span class="comment">/* parsing */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* parsing data to msg */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (parsing_failed)</div>
<div class="line">        res = -1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> res;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> msg_write(<span class="keyword">const</span> msg_t *msg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> write(msg);</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="comment">/* interpret and return result as status */</span></div>
<div class="line">status_t msg_is_valid(<span class="keyword">const</span> msg_t *msg)</div>
<div class="line">{</div>
<div class="line">    uint8_t mistakes_in_msg = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* check */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> mistakes_in_msg ? -1 : 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* interpret and return status as result */</span></div>
<div class="line">msg_t *msg_parse(uint8_t *<a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>, uint8_t len, msg_t *msg)</div>
<div class="line">{</div>
<div class="line">    msg_t *ptr = msg;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* parsing data to msg */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (parsing_failed)</div>
<div class="line">        ptr = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ptr;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* returning pointer to allocated memory */</span></div>
<div class="line">msg_t *msg_alloc()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> malloc(<span class="keyword">sizeof</span>(msg_t));</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md175"></a>
7.8. Точка выхода из функции</h3>
<ol type="1">
<li>В функции должна быть только одна точка выхода, даже если фнукция не возвращает значение</li>
<li>Точка выхода должна быть в конце функции</li>
<li>При ветвлениях переход к точке выхода осуществялется с помощью оператора <b>goto</b> и соответсвующей метки</li>
</ol>
<p>Исключение - функция состоящая из оператора switch() (см. Оператор switch)</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> foo()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> res = -1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (is_error_acquired1())</div>
<div class="line">        <span class="keywordflow">goto</span> _exit;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (is_error_acquired2())</div>
<div class="line">    {</div>
<div class="line">        res = -2;</div>
<div class="line">        <span class="keywordflow">goto</span> _exit;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">_exit:</div>
<div class="line">    <span class="keywordflow">return</span> res;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> bar()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> res;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (is_error_acquired())</div>
<div class="line">        <span class="keywordflow">goto</span> _exit;</div>
<div class="line"> </div>
<div class="line">    table_lock();</div>
<div class="line"> </div>
<div class="line">    res = do_something();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (rse &lt; 0)</div>
<div class="line">        <span class="keywordflow">goto</span> _exit_unlock;</div>
<div class="line"> </div>
<div class="line">_exit_unlock:</div>
<div class="line">    table_unlock();</div>
<div class="line">_exit:</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> foo()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (is_error_acquired1())</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (is_error_acquired2())</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> -2;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> bar()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> res;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (is_error_acquired())</div>
<div class="line">        <span class="keywordflow">return</span></div>
<div class="line"> </div>
<div class="line">    table_lock();</div>
<div class="line"> </div>
<div class="line">    res = do_something();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (rse &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        table_unlock();</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    table_unlock();</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md177"></a>
7.9. Оператор return, статус выполнения</h3>
<p>Статус выполнения должен определяться специальным типом данных</p>
<p>Возвращаемые значения статуса:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Код ошибки   </td><td class="markdownTableBodyNone">_. &lt; 0    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Код успеха   </td><td class="markdownTableBodyNone">_. 0   </td></tr>
</table>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> status_t <span class="keywordtype">int</span></div>
<div class="line"> </div>
<div class="line">status_t connect()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> res = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (connection_failed())</div>
<div class="line">        res = -10;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> res;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">status_t write_something()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* write() returns bytes written number on success and -1 on fail */</span></div>
<div class="line">    <span class="keywordtype">int</span> res = write();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (res &gt;= 0) ? 0 : res;</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> connect()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> res = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (connection_failed())</div>
<div class="line">        res = 10;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> res;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">status_t write_something()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* write() returns bytes written number on success and -1 on fail */</span></div>
<div class="line">    <span class="keywordtype">int</span> res = write();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> res;</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md179"></a>
7.10. Фабричные функции</h3>
<p>Фабричная функция - функция, возвращающая адрес на выделенную в функции память</p>
<ol type="1">
<li>Адрес указателя под выделяемую память передаётся в функцию последним параметром</li>
<li>Фукция возвращает статус выполнения через оператор <b>return</b> (см. Оператор return, возвращаемое значение)</li>
</ol>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line">status_t dialog_create(<span class="keyword">const</span> seession_t *session, dialog_t **dlg);</div>
<div class="line"> </div>
<div class="line">status_t dialog_create(<span class="keyword">const</span> seession_t *session, dialog_t **dlg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> res = -1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!dlg)</div>
<div class="line">        <span class="keywordflow">goto</span> _exit;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((*dlg) = malloc(<span class="keyword">sizeof</span>(**dlg)))</div>
<div class="line">    {</div>
<div class="line">        (*dlg)-&gt;session = session;</div>
<div class="line">        res = 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">_exit:</div>
<div class="line">    <span class="keywordflow">return</span> res;</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line">dialog_t *dialog_create(<span class="keyword">const</span> seession_t *session);</div>
<div class="line"> </div>
<div class="line">dialog_t *dialog_create(<span class="keyword">const</span> seession_t *session)</div>
<div class="line">{</div>
<div class="line">    dialog_t *dlg = malloc(<span class="keyword">sizeof</span>(*dlg));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (dlg)</div>
<div class="line">    {</div>
<div class="line">        dlg-&gt;session = session;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> dlg;</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md181"></a>
7.11. Спецификатор const</h3>
<p>При передаче параметров в функцио по указателю, если логика функции не предполагает изменение данных по этому указателю необходимо использовать спецификатор <b>const</b></p>
<p>Иными словами, если функция предполагает изменение данных по указателю, то это сразу видно из прототипа</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> message_show(<span class="keyword">const</span> msg_t *msg); <span class="comment">/* msg will not be changed */</span></div>
<div class="line"><span class="keywordtype">void</span> message_update(msg_t *msg);     <span class="comment">/* msg will be changed     */</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> message_show(<span class="keyword">const</span> msg_t *msg)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Print to stdout */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> message_update(msg_t *msg)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Changing msg */</span></div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> message_show(msg_t *msg);   <span class="comment">/* will msg be changed ??? */</span></div>
<div class="line"><span class="keywordtype">void</span> message_update(msg_t *msg); <span class="comment">/* will msg be changed ??? */</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> message_show(msg_t *msg)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Print to stdout */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> message_update(msg_t *msg)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Changing msg */</span></div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<hr  />
<h2><a class="anchor" id="autotoc_md183"></a>
8. Переменные</h2>
<hr  />
<h3><a class="anchor" id="autotoc_md185"></a>
8.1. Объявление</h3>
<p>Переменные объявляются в начале блока</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> foo()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> var1, var2;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* some code */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ()</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> var3;</div>
<div class="line">        <span class="comment">/* some code */</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> var4;</div>
<div class="line">        <span class="comment">/* some code */</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> foo()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> var1;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* some code */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> var2;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ()</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> var3;</div>
<div class="line">        <span class="comment">/* some code */</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* some code */</span></div>
<div class="line">        <span class="keywordtype">int</span> var4;</div>
<div class="line">        <span class="comment">/* some code */</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md187"></a>
8.2. Инициализация</h3>
<p><b>ОБЯЗАТЕЛЬНА</b></p>
<hr  />
<h2><a class="anchor" id="autotoc_md189"></a>
9. Перечисления</h2>
<ol type="1">
<li>Имя типа перечисления пишется в формате <b>enum_name_e</b></li>
<li>Имя значения перечисления пишется в формате <b>eENUM_VALUE_NAME</b></li>
<li>Имя значения содержит имя типа целиком или частично в виде префикса</li>
</ol>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span></div>
<div class="line">{</div>
<div class="line">    eDESK_COLOR_WHITE_BROWN,</div>
<div class="line">    eDESK_COLOR_WHITE_BLUE,</div>
<div class="line">    eDESK_COLOR_DARK_ORANGE</div>
<div class="line">} desk_color_e;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span></div>
<div class="line">{</div>
<div class="line">    eMSG_TYPE_REQUEST,</div>
<div class="line">    eMSG_TYPE_RESPONSE,</div>
<div class="line">} msg_type_e;</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span></div>
<div class="line">{</div>
<div class="line">    DESK_COLOR_WHITE_BROWN,</div>
<div class="line">    DESK_COLOR_WHITE_BLUE,</div>
<div class="line">    DESK_COLOR_DARK_ORANGE</div>
<div class="line">} desk_color;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span></div>
<div class="line">{</div>
<div class="line">    request,</div>
<div class="line">    response,</div>
<div class="line">} e_msg_type;</div>
</div><!-- fragment --> </details>
<hr  />
<h2><a class="anchor" id="autotoc_md191"></a>
10. Структуры</h2>
<ol type="1">
<li>Имя структуры пишется в формате <b>type_name_t</b></li>
<li>При определении специального типа для структуры с помощью оператора <b>typedef</b> имя нового типа должно соответствовать имени структуры, если она не анонимна.</li>
<li>При определении специального типа для анонимной структуры, имя типа должно соответствовать формату имени структуры</li>
</ol>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">    hdr_t   hdr;</div>
<div class="line">    uint8_t <a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>[0];</div>
<div class="line">} msg_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>linked_list_t</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">void</span> *<a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>;</div>
<div class="line">    <span class="keyword">struct </span>linked_list_t *next;</div>
<div class="line">} linked_list_t;</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">    hdr_t   hdr;</div>
<div class="line">    uint8_t <a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>[0];</div>
<div class="line">} msg;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>linked_list_s</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">void</span> *<a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>;</div>
<div class="line">    <span class="keyword">struct </span>linked_list_s *next;</div>
<div class="line">} linked_list_t;</div>
</div><!-- fragment --> </details>
<hr  />
<h2><a class="anchor" id="autotoc_md193"></a>
11. Объединения</h2>
<ol type="1">
<li>Имя объединентя пишется в формате <b>union_name_u</b></li>
<li>Запрещено использовать анонимные объединения в структурах</li>
<li>Вместо анонимных объединений использовать объединение с именем <b>"u"</b></li>
</ol>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">    msg_type_e type;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">union</span></div>
<div class="line">    {</div>
<div class="line">        msg_response_t response;</div>
<div class="line">        msg_request_t  request;</div>
<div class="line">    } u;</div>
<div class="line">} msg_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">union</span></div>
<div class="line">{</div>
<div class="line">    sip_user_t sip_user;</div>
<div class="line">    fxs_user_t fxs_user;</div>
<div class="line">    fxo_user_t fxo_user;</div>
<div class="line">} user_u;</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">    msg_type_e type;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">union</span></div>
<div class="line">    {</div>
<div class="line">        msg_response_t response;</div>
<div class="line">        msg_request_t  request;</div>
<div class="line">    };</div>
<div class="line">} msg_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">union</span></div>
<div class="line">{</div>
<div class="line">    sip_user_t sip_user;</div>
<div class="line">    fxs_user_t fxs_user;</div>
<div class="line">    fxo_user_t fxo_user;</div>
<div class="line">} user;</div>
</div><!-- fragment --> </details>
<hr  />
<h2><a class="anchor" id="autotoc_md195"></a>
12. Оператор sizeof</h2>
<p>По возможности параметры в <b>sizeof</b> должны передаваться через имена переменных</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> *int_val;</div>
<div class="line">    uint16_t *u16_array;</div>
<div class="line">    uint8_t *sending_buf;</div>
<div class="line"> </div>
<div class="line">    int_val = malloc(<span class="keyword">sizeof</span>(*int_val));</div>
<div class="line">    u16_array = malloc(<span class="keyword">sizeof</span>(*u16_array) * 10);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>msg_t</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">struct </span>header_t</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">int</span> length;</div>
<div class="line">        } hdr;</div>
<div class="line"> </div>
<div class="line">        uint32_t <a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>[0];</div>
<div class="line">    } message;</div>
<div class="line"> </div>
<div class="line">    sending_buf = malloc(<span class="keyword">sizeof</span>(message) + (<span class="keyword">sizeof</span>(*message.data) * message.hdr.length));</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> *int_val;</div>
<div class="line">    uint16_t *u16_array;</div>
<div class="line">    uint8_t *sending_buf;</div>
<div class="line"> </div>
<div class="line">    int_val = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line">    u16_array = malloc(<span class="keyword">sizeof</span>(uint16_t) * 10);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>msg_t</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">struct </span>header_t</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">int</span> length;</div>
<div class="line">        } hdr;</div>
<div class="line"> </div>
<div class="line">        uint32_t <a class="code hl_variable" href="../../d2/d56/group__sipbl__monitor.html#gad04c150c29025c694cfdb62b3caf2a27">data</a>[0];</div>
<div class="line">    } message;</div>
<div class="line"> </div>
<div class="line">    sending_buf = malloc(<span class="keyword">sizeof</span>(msg_t) + (<span class="keyword">sizeof</span>(uint32_t) * message.hdr.length));</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<hr  />
<h2><a class="anchor" id="autotoc_md197"></a>
13. Битовые поля</h2>
<ol type="1">
<li>Битовые поля объявляются с типом <b>uint8_t</b> и размещаются друг за другом</li>
<li>Между именем поля, ":" и размером пробелы не ставятся</li>
<li>Описание битовых полей заканчивается анонимным полем размером 0</li>
</ol>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>flags_t</div>
<div class="line">{</div>
<div class="line">    uint8_t flag_0:1,</div>
<div class="line">            flag_1:1,</div>
<div class="line">            flag_2:1,</div>
<div class="line">            complex_flag:3,</div>
<div class="line">            :0;</div>
<div class="line">};</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>flags_t</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> flag_0:1;</div>
<div class="line">    <span class="keywordtype">char</span> flag_1:2;</div>
<div class="line">    <span class="keywordtype">int</span>  complex_flag:3;</div>
<div class="line">};</div>
</div><!-- fragment --> </details>
<hr  />
<h2><a class="anchor" id="autotoc_md199"></a>
14. Константы</h2>
<p>Имена констант пишутся в формате <b>kCONST_NAME</b> Константные указатели в параметрах функций <b>не оформляются</b> как константы</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> kUSERS_LIMIT = 50000;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *kSYSTEM_NAME = <span class="stringliteral">&quot;Bolgenos&quot;</span>;</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> users_limit = 50000;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *system_name = <span class="stringliteral">&quot;Bolgenos&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> sys_init(<span class="keyword">const</span> <span class="keywordtype">char</span> *kSYSTEM_PARAMETER);</div>
</div><!-- fragment --> </details>
<hr  />
<h2><a class="anchor" id="autotoc_md204"></a>
15. Magic Numbers</h2>
<p><b>Magic Numbers</b> - запрещены</p>
<p>0 - <b>не</b> magic number 1 - <b>не</b> magic number Любые другие числовые литералы - magic number</p>
<p>Все константные значения нужно определять через:</p>
<ul>
<li>макросы</li>
<li>константы</li>
<li>перечисления</li>
</ul>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; subsystem_count; ++i)</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">max_value = (shelf_size * SHELF_COUNT) * CABINET_COUNT;</div>
<div class="line"> </div>
<div class="line">sub_t subscription_table[eSUB_TYPE_MAX];</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; 3; ++i)</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">max_value = (shelf_size * 4) * 2;</div>
<div class="line"> </div>
<div class="line">sub_t subscription_table[10];</div>
</div><!-- fragment --> </details>
<hr  />
<h2><a class="anchor" id="autotoc_md207"></a>
16. Форматирование</h2>
<hr  />
<h2><a class="anchor" id="autotoc_md209"></a>
16.1 Приоритет операций</h2>
<p>Приоритет операций должен быть точно и однозначно описан с помощью расстановки скобок. Если расстановка скобок не помогает однозначно определить приоритет операций, то следует разделить сложную операцию на простые</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line">some_count = (val * multiplier) + reminder;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (((a &gt; b) &amp;&amp; (c &lt; d)) || (a == d))</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> str[STR_SIZE];</div>
<div class="line"><span class="keywordtype">char</span> *ptr = str;</div>
<div class="line"><span class="keywordtype">char</span> symbol = <span class="charliteral">&#39;a&#39;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; (STR_SIZE - 1); ++i)</div>
<div class="line">{</div>
<div class="line">    (*ptr) = symbol++;</div>
<div class="line">    ++ptr;</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line">some_count = val * multiplier + reminder;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (a &gt; b &amp;&amp; c &lt; d || a == d)</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> str[n];</div>
<div class="line"><span class="keywordtype">char</span> *ptr = str;</div>
<div class="line"><span class="keywordtype">char</span> symbol = <span class="charliteral">&#39;a&#39;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; n - 1; ++i)</div>
<div class="line">{</div>
<div class="line">    *ptr++ = symbol++;</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md214"></a>
16.2 Перенос сложных логических выражений</h3>
<p>Части сложного логического выражения переносятся на новую строку c предворяющим оператором на уровне начала выражения</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (!pj_strcmp(&amp;a1-&gt;name, &amp;inactive)</div>
<div class="line">    || !pj_strcmp(&amp;a1-&gt;name, &amp;sendrecv)</div>
<div class="line">    || !pj_strcmp(&amp;a1-&gt;name, &amp;sendonly)</div>
<div class="line">    || !pj_strcmp(&amp;a1-&gt;name, &amp;recvonly))</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> condition = (!pj_strcmp(&amp;a1-&gt;name, &amp;inactive)</div>
<div class="line">                 || !pj_strcmp(&amp;a1-&gt;name, &amp;sendrecv)</div>
<div class="line">                 || !pj_strcmp(&amp;a1-&gt;name, &amp;sendonly)</div>
<div class="line">                 || !pj_strcmp(&amp;a1-&gt;name, &amp;recvonly));</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (!pj_strcmp(&amp;a1-&gt;name, &amp;inactive) ||</div>
<div class="line">    !pj_strcmp(&amp;a1-&gt;name, &amp;sendrecv) ||</div>
<div class="line">    !pj_strcmp(&amp;a1-&gt;name, &amp;sendonly) ||</div>
<div class="line">    !pj_strcmp(&amp;a1-&gt;name, &amp;recvonly))</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> condition = (!pj_strcmp(&amp;a1-&gt;name, &amp;inactive)</div>
<div class="line">        || !pj_strcmp(&amp;a1-&gt;name, &amp;sendrecv)</div>
<div class="line">        || !pj_strcmp(&amp;a1-&gt;name, &amp;sendonly)</div>
<div class="line">        || !pj_strcmp(&amp;a1-&gt;name, &amp;recvonly));</div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md216"></a>
16.3 Комментарии</h3>
<p>Поясняющий комментарий к коду - /**/ Временно отключённый код - // или "#if 0"</p>
<p>Каждая строка многострочного комментария начинается со "*" Все символы "*" многострочного комментария должны быть друг под другом</p>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="comment">/* This is multiline</span></div>
<div class="line"><span class="comment"> * code commentary</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* This is one line code commentary */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Next code is commented */</span></div>
<div class="line"><span class="comment">// int extra_val = foo();</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Next code is switched off */</span></div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="keywordtype">int</span> extra_val1 = bar();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="comment">// bad multiline</span></div>
<div class="line"><span class="comment">// code comment</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// bad one line code comment</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">   bad multiline code comment</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* int extra_val = foo(); */</span></div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md221"></a>
16.4 #warning и TODO</h3>
<p>При использовании #warning и TODO-комментария нужно указывать авторство и время жизни записи или условие, от которого эта запись зависит</p>
<p>TODO-комментарий следует оформлять в формате </p><pre class="fragment">/** @todo something to do (AUTHOR, DATE_TO_DO) */
</pre> <details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="preprocessor">#warning dont use ENTRY at all, make new route modes for service prefixes instead, ENTRY is legacy (Tyryshkin M.V. fix by november 2022)</span></div>
<div class="line"> </div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="preprocessor">#warning this code is bad</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* TODO: Refactor this please */</span></div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md223"></a>
16.5 Оператор if</h3>
<ul>
<li>Многострочный вариант - блок</li>
<li>Однострочный вариант - строка кода на следующей строке</li>
<li><b>else</b> не должен быть на одной строке со скобками</li>
<li><b>if</b> и <b>else</b> должны быть оформлены одинаково - оба однострочны или оба многострочны</li>
</ul>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (condition)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* code */</span></div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* code */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (bad_condition)</div>
<div class="line">    <span class="keywordflow">goto</span> _exit;</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (condition)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* code */</span></div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">/* code */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (condition)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* code */</span></div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">    <span class="comment">/* code */</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (bad_condition) <span class="keywordflow">goto</span> _exit;</div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md225"></a>
16.6 Цикл for</h3>
<ul>
<li>Всегда многострочный</li>
</ul>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; SUBSYS_COUNT; ++i)</div>
<div class="line">{</div>
<div class="line">    subsys[i].init();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (; handle_something_until_fail();)</div>
<div class="line">{</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; SUBSYS_COUNT; ++i)</div>
<div class="line">    subsys[i].init();</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (; handle_something_until_fail(););</div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md227"></a>
16.7 Цикл while</h3>
<ul>
<li>Всегда многострочный</li>
</ul>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordflow">while</span> (i &lt; SUBSYS_COUNT)</div>
<div class="line">{</div>
<div class="line">    subsys[i++].init();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span> (handle_something_until_fail())</div>
<div class="line">{</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordflow">while</span> (i &lt; SUBSYS_COUNT)</div>
<div class="line">    subsys[i++].init();</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span> (handle_something_until_fail());</div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md229"></a>
16.8 Цикл do-while</h3>
<ul>
<li><b>while</b> на одной строке с закрытием блока</li>
</ul>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordflow">do</span></div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* code */</span></div>
<div class="line">} <span class="keywordflow">while</span> (condition);</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordflow">do</span> {</div>
<div class="line">    <span class="comment">/* code */</span></div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">while</span> (condition);</div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md231"></a>
16.9 Оператор switch</h3>
<p>У оператора switch больше всего исключений, главное правило - максимальная читаемость</p>
<ul>
<li>Формат всех операторов <b>case</b> и <b>default</b> должен быть одинаковым</li>
<li>блоки в <b>case</b> не обязательны</li>
<li><b>default</b> обязателен</li>
<li><b>break</b> в <b>default</b> обязателен</li>
<li>если хотя бы в одном <b>case</b> есть блок, то блок должен быть везде</li>
<li>код в <b>case</b> должен быть небольшим (до 10 строк)</li>
<li>многострочный код под case должен иметь один отступ</li>
<li>однострочный код может быть на одной строке с <b>case</b></li>
<li><b>break</b> в многострочном <b>case</b> находится на том же отступе, что и код</li>
<li><b>break</b> в однострочном <b>case</b> находится в конце строки</li>
<li><b>case</b> без <b>break</b> должен иметь коммент /* no break */</li>
<li>в <b>case</b> может не быть <b>brake</b>, если в нём используется <b>return</b></li>
<li>если хотя бы один <b>case</b> использует <b>return</b>, то <b>return</b> должен использоваться везде</li>
<li><b>return</b> может использоваться только в однострочных <b>case</b></li>
</ul>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="comment">/* One line case-break */</span></div>
<div class="line"><span class="keywordflow">switch</span> (msg_type)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">case</span> eMSG_TYPE_REQUEST:  proc_request();     <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> eMSG_TYPE_RESPONSE: proc_response();    <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:                 proc_unknown_msg(); <span class="keywordflow">break</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Multi line case */</span></div>
<div class="line"><span class="keywordflow">switch</span> (msg_type)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">case</span> eMSG_TYPE_REQUEST:</div>
<div class="line">        proc_request();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> eMSG_TYPE_RESPONSE:</div>
<div class="line">        proc_response();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        proc_unknown_msg();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Multi line case with block */</span></div>
<div class="line"><span class="keywordflow">switch</span> (msg_type)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">case</span> eMSG_TYPE_REQUEST:</div>
<div class="line">    {</div>
<div class="line">        proc_request();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> eMSG_TYPE_RESPONSE:</div>
<div class="line">    {</div>
<div class="line">        proc_response();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">    {</div>
<div class="line">        proc_unknown_msg();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* One line case-return */</span></div>
<div class="line"><span class="keywordflow">switch</span> (msg_type)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">case</span> eMSG_TYPE_REQUEST:  <span class="keywordflow">return</span> proc_request();</div>
<div class="line">    <span class="keywordflow">case</span> eMSG_TYPE_RESPONSE: <span class="keywordflow">return</span> proc_response();</div>
<div class="line">    <span class="keywordflow">default</span>:                 <span class="keywordflow">return</span> proc_unknown_msg();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* case fall-through (no break) */</span></div>
<div class="line"><span class="keywordflow">switch</span> (event_type)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">case</span> eEVENT_1:</div>
<div class="line">        proc_event1();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> eEVENT_2:</div>
<div class="line">        proc_event2();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> eEVENT_3:</div>
<div class="line">        proc_event3();</div>
<div class="line">        <span class="comment">/* no break */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        proc_event_default();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="comment">/* One line case-break */</span></div>
<div class="line"><span class="keywordflow">switch</span> (msg_type)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">case</span> eMSG_TYPE_REQUEST: proc_request(); do_some_thing_more(); <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> eMSG_TYPE_RESPONSE: proc_response(); <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>: proc_unknown_msg(); <span class="keywordflow">break</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Multi line case */</span></div>
<div class="line"><span class="keywordflow">switch</span> (msg_type)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">case</span> eMSG_TYPE_REQUEST:</div>
<div class="line">        do_something_else();</div>
<div class="line">        proc_request();</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> eMSG_TYPE_RESPONSE:</div>
<div class="line">        proc_response();</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        proc_unknown_msg();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Multi line case with block */</span></div>
<div class="line"><span class="keywordflow">switch</span> (msg_type)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">case</span> eMSG_TYPE_REQUEST:</div>
<div class="line">    {</div>
<div class="line">        proc_request();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> eMSG_TYPE_RESPONSE:</div>
<div class="line">        proc_response();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        proc_unknown_msg();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* case return */</span></div>
<div class="line"><span class="keywordflow">switch</span> (msg_type)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">case</span> eMSG_TYPE_REQUEST:</div>
<div class="line">        do_something_else();</div>
<div class="line">        proc_request();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> eMSG_TYPE_RESPONSE:</div>
<div class="line">        do_something_else();</div>
<div class="line">        <span class="keywordflow">return</span> proc_response();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        proc_unknown_msg();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* case fall-through (no break) */</span></div>
<div class="line"><span class="keywordflow">switch</span> (event_type)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">case</span> eEVENT_1:</div>
<div class="line">        proc_event1();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> eEVENT_2:</div>
<div class="line">        proc_event2();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> eEVENT_3:</div>
<div class="line">        proc_event3();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        proc_event_default();</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<hr  />
<h3><a class="anchor" id="autotoc_md233"></a>
16.10 Оператор goto</h3>
<ul>
<li><b>goto</b> используется только для обеспечения единой точнки выхода из функции</li>
<li><b>goto</b> всегда должен вести вниз по коду</li>
<li>имя метки должно соответствовать формату _label_name</li>
<li>метка может находится только в основном блоке функции</li>
<li>метка ращмещается на уровне скобок основного блока функции</li>
</ul>
<details >
<summary >
<b style="color: green"> хорошо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (guard_condition1)</div>
<div class="line">        <span class="keywordflow">goto</span> _exit;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* code */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (guard_condition2)</div>
<div class="line">        <span class="keywordflow">goto</span> _exit;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* code */</span></div>
<div class="line"> </div>
<div class="line">_exit:</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<details >
<summary >
<b style="color: red"> плохо </b><b style="color: blue"> &gt;&gt;&gt; </b></summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (guard_condition1)</div>
<div class="line">    {</div>
<div class="line">    _exit:</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">_cycle:</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* code */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (cycle_condition)</div>
<div class="line">        <span class="keywordflow">goto</span> _cycle;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (guard_condition2)</div>
<div class="line">        <span class="keywordflow">goto</span> _exit;</div>
<div class="line">}</div>
</div><!-- fragment --> </details>
<hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Документация E-SBC проекта</a></li><li class="navelem"><a class="el" href="../../dd/d58/p_project_managment.html">Ведение проекта</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
